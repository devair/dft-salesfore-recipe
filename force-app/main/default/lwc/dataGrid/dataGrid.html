<template>
    <div class="slds-table slds-table_bordered slds-table_cell-buffer">        
        <table class="slds-table slds-table_bordered">
            <thead>                
                <template for:each={mainRecords.columns} for:item="column">
                    <th key={column.fieldName} scope="col">
                        {column.label}
                    </th>
                </template>                                    
            </thead>
            <tbody>
                <template for:each={processedMainRecords} for:item="mainRecord">
                    <tr key={mainRecord.id} >                        
                        <template for:each={mainRecord.cells} for:item="cell">
                            <template lwc:if={cell.firstField}>
                                <td key={cell.fieldName} class="slds-p-left_none">
                                    <template lwc:if={mainRecord.children}>
                                        <lightning-button-icon 
                                            class="slds-p-left_x-small"
                                            icon-name={mainRecord.icon}  
                                            data-id = {mainRecord.id} 
                                            variant="bare"
                                            value={mainRecord}
                                            onclick={handleExpand}
                                        >
                                        </lightning-button-icon>
                                    </template>
                                    {cell.value}
                                </td>
                            </template>
                            <template lwc:else>
                                <td key={cell.fieldName} >
                                    <template lwc:if={cell.isDate}>                                    
                                        <lightning-formatted-date-time value={cell.value} year="numeric" month="2-digit" day="2-digit">
                                        </lightning-formatted-date-time>
                                    </template>
                                    <template lwc:elseif={cell.isCurrency}>                                    
                                        <lightning-formatted-number value={cell.value} 
                                            format-style="currency" 
                                            currency-code="BRL" 
                                            currency-display-as="code">                                        
                                        </lightning-formatted-number>
                                    </template>
                                    <template lwc:elseif={cell.isNumber}>                                    
                                        <lightning-formatted-number value={cell.value}></lightning-formatted-number>
                                    </template>
                                    <template lwc:else>
                                        {cell.value}
                                    </template>
                                </td>
                            </template>    
                        </template>
                    </tr>
                    <!-- Tabela de Itens ( first level expandida) -->
                    <template if:true={mainRecord.isExpanded}>
                        <tr key={mainRecord.expanded} class="slds-hint-parent">
                            <td class="vertical-line" colspan={mainRecord.firstLevelColumns.length}>
                                <div class="slds-p-top_large slds-p-bottom_large">
                                    <table class="slds-table slds-table_bordered slds-table_cell-buffer">
                                        <thead>                                            
                                            <template for:each={mainRecord.firstLevelColumns} for:item="column">
                                                <th key={column.fieldName} scope="col">
                                                    {column.label}
                                                </th>
                                            </template>                                        
                                        </thead>                                                                              
                                        <tbody>                                            
                                            <template for:each={mainRecord.firstLevelRecords} for:item="levelOne">
                                                <tr key={levelOne.id}>
                                                    <template for:each={levelOne.cells} for:item="cell">                                                        
                                                        <td key={cell.fieldName} data-label={cell.label}>                                                            
                                                            <template lwc:if={cell.isDate}>                                    
                                                                <lightning-formatted-date-time value={cell.value} year="numeric" month="2-digit" day="2-digit">
                                                                </lightning-formatted-date-time>
                                                            </template>
                                                            <template lwc:elseif={cell.isCurrency}>                                    
                                                                <lightning-formatted-number value={cell.value} 
                                                                    format-style="currency" 
                                                                    currency-code="BRL" 
                                                                    currency-display-as="code">                                        
                                                                </lightning-formatted-number>
                                                            </template>
                                                            <template lwc:else>
                                                                {cell.value}
                                                            </template>
                                                        </td>
                                                    </template>
                                                </tr>
                                            </template>
                                        </tbody>                                        
                                    </table>
                                </div>
                            </td>
                        </tr>
                    </template>                              
                </template>
            </tbody>
        </table>
    </div>
</template>